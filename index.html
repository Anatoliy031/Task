<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task-—Ç—Ä–µ–∫–µ—Ä ‚Äî –î–†–ù–£ (–ö—É–±–∞–Ω—å—ç–Ω–µ—Ä–≥–æ)</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #111b2e;
      --card2: #0f172a;
      --text: #e6eefc;
      --muted: #a8b3c7;
      --line: rgba(255,255,255,.10);
      --good: #4ade80;
      --warn: #fbbf24;
      --bad:  #fb7185;
      --info: #60a5fa;
      --chip: rgba(255,255,255,.08);
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --r: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--sans);
      background: radial-gradient(1200px 700px at 15% 10%, rgba(96,165,250,.18), transparent 55%),
                  radial-gradient(1000px 700px at 85% 0%, rgba(74,222,128,.12), transparent 50%),
                  var(--bg);
      color: var(--text);
    }
    a { color: inherit; }
    .wrap { max-width: 1180px; margin: 0 auto; padding: 18px; }
    .topbar {
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
      padding: 14px 16px; border: 1px solid var(--line); border-radius: var(--r);
      background: rgba(17,27,46,.75); backdrop-filter: blur(10px); box-shadow: var(--shadow);
      position: sticky; top: 10px; z-index: 20;
    }
    .title { display:flex; flex-direction:column; gap:4px; }
    .title h1 { margin:0; font-size: 16px; letter-spacing: .2px; }
    .title div { color: var(--muted); font-size: 12px; }
    .tabs { display:flex; gap: 8px; align-items:center; flex-wrap: wrap; }
    .tab {
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
    }
    .tab.active { background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.45); }
    .grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      align-items: start;
    }
    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
      .topbar { position: static; }
    }
    .card {
      border: 1px solid var(--line);
      border-radius: var(--r);
      background: rgba(17,27,46,.65);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card .hd {
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .card .hd .h {
      font-size: 13px; font-weight: 700;
      display:flex; align-items:center; gap:10px;
    }
    .card .bd { padding: 14px; }
    .muted { color: var(--muted); }
    .chips { display:flex; flex-wrap: wrap; gap: 8px; }
    .chip {
      background: var(--chip);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      display:flex;
      align-items:center;
      gap: 8px;
      white-space: nowrap;
    }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--info); }
    .dot.good { background: var(--good); }
    .dot.warn { background: var(--warn); }
    .dot.bad { background: var(--bad); }

    label { display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input, select, textarea {
      width: 100%;
      background: rgba(15,23,42,.75);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 10px;
      outline: none;
      font-size: 13px;
    }
    textarea { min-height: 78px; resize: vertical; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 640px) {
      .row { grid-template-columns: 1fr; }
    }
    .btns { display:flex; gap: 8px; flex-wrap: wrap; }
    button {
      cursor: pointer;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      font-size: 13px;
    }
    button.primary { background: rgba(96,165,250,.20); border-color: rgba(96,165,250,.55); }
    button.danger { background: rgba(251,113,133,.16); border-color: rgba(251,113,133,.45); }
    button.good { background: rgba(74,222,128,.14); border-color: rgba(74,222,128,.40); }
    button:disabled { opacity:.55; cursor:not-allowed; }

    .table-wrap { overflow:auto; border-radius: 14px; border:1px solid var(--line); }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 860px;
      background: rgba(15,23,42,.55);
    }
    th, td {
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      vertical-align: top;
      font-size: 13px;
    }
    th {
      position: sticky; top: 0;
      background: rgba(15,23,42,.95);
      text-align: left;
      color: var(--muted);
      font-weight: 600;
      z-index: 5;
    }
    tr:hover td { background: rgba(255,255,255,.03); }
    .mono { font-family: var(--mono); font-size: 12px; }
    .pill {
      display:inline-flex; align-items:center; gap:8px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      font-size: 12px;
      white-space: nowrap;
    }
    .pill.bad { border-color: rgba(251,113,133,.45); background: rgba(251,113,133,.12); }
    .pill.warn { border-color: rgba(251,191,36,.45); background: rgba(251,191,36,.10); }
    .pill.good { border-color: rgba(74,222,128,.45); background: rgba(74,222,128,.10); }

    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,.55);
      display: none; align-items:center; justify-content:center; padding: 16px;
      z-index: 50;
    }
    .modal.open { display:flex; }
    .modal .box {
      width: min(720px, 100%);
      background: rgba(17,27,46,.90);
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal .box .hd {
      padding: 12px 14px; border-bottom: 1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .modal .box .bd { padding: 14px; }

    .timeline {
      border:1px solid var(--line);
      border-radius: 14px;
      overflow: auto;
      background: rgba(15,23,42,.55);
    }
    .tl { min-width: 980px; }
    .tl-head {
      display:grid;
      grid-template-columns: 280px 1fr;
      position: sticky; top: 0;
      background: rgba(15,23,42,.95);
      z-index: 5;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .tl-head .left {
      padding: 10px; color: var(--muted); font-size: 12px; font-weight: 600;
      border-right: 1px solid rgba(255,255,255,.08);
    }
    .months { display:grid; grid-template-columns: repeat(12, 1fr); }
    .months div {
      padding: 10px 6px;
      border-left: 1px solid rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12px;
      text-align: center;
      white-space: nowrap;
    }
    .tl-row {
      display:grid;
      grid-template-columns: 280px 1fr;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .tl-row .who {
      padding: 10px;
      border-right: 1px solid rgba(255,255,255,.08);
    }
    .who .nm { font-size: 13px; font-weight: 650; }
    .who .ps { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .bars {
      position: relative;
      height: 54px;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: calc(100%/12) 100%;
    }
    .bar {
      position:absolute; top: 14px; height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(96,165,250,.55);
      background: rgba(96,165,250,.18);
      display:flex; align-items:center; justify-content:center;
      padding: 0 10px;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bar.alt {
      border-color: rgba(74,222,128,.50);
      background: rgba(74,222,128,.12);
    }
    .legend {
      display:flex; gap: 10px; flex-wrap: wrap; align-items:center;
      font-size: 12px; color: var(--muted);
    }
    .sep { height: 1px; background: var(--line); margin: 12px 0; }
    .small { font-size: 12px; }
    .kbd {
      font-family: var(--mono);
      border:1px solid var(--line);
      border-bottom-color: rgba(255,255,255,.2);
      background: rgba(255,255,255,.04);
      padding: 2px 6px;
      border-radius: 8px;
      font-size: 11px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <h1>Task-—Ç—Ä–µ–∫–µ—Ä (6 –ø–æ–ª–µ–π) ‚Äî –î–†–ù–£, –§–∏–ª–∏–∞–ª –ü–ê–û ¬´–†–æ—Å—Å–µ—Ç–∏ –Æ–≥¬ª ‚Äî ¬´–ö—É–±–∞–Ω—å—ç–Ω–µ—Ä–≥–æ¬ª</h1>
        <div id="subtitle" class="muted">–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GitHub Pages.</div>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="tasks">–ó–∞–¥–∞—á–∏</button>
        <button class="tab" data-tab="vacations">–û—Ç–ø—É—Å–∫–∞</button>
        <button class="tab" data-tab="help">–ü–æ–º–æ—â—å</button>
      </div>
    </div>

    <!-- TASKS TAB -->
    <section id="tab-tasks" class="grid" style="display:grid;">
      <div class="card">
        <div class="hd">
          <div class="h">–†–µ–µ—Å—Ç—Ä –∑–∞–¥–∞—á</div>
          <div class="legend">
            <span class="pill bad"><span class="dot bad"></span>üî¥ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
            <span class="pill warn"><span class="dot warn"></span>üü° ‚â§3 –¥–Ω—è</span>
            <span class="pill"><span class="dot"></span>–æ—Å—Ç–∞–ª—å–Ω–æ–µ</span>
          </div>
        </div>
        <div class="bd">
          <div class="chips" id="summaryChips"></div>
          <div class="sep"></div>

          <div class="row">
            <div>
              <label>–ü–æ–∏—Å–∫ (ID / –∑–∞–¥–∞—á–∞ / –≤–ª–∞–¥–µ–ª–µ—Ü)</label>
              <input id="q" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–û–õ–°, –¥–æ–≥–æ–≤–æ—Ä, –§–ê–°, T-012..." />
            </div>
            <div class="row" style="grid-template-columns: 1fr 1fr; gap:10px;">
              <div>
                <label>–í–ª–∞–¥–µ–ª–µ—Ü</label>
                <select id="fOwner"></select>
              </div>
              <div>
                <label>–°—Ç–∞—Ç—É—Å</label>
                <select id="fStatus">
                  <option value="">–í—Å–µ</option>
                  <option value="Backlog">Backlog</option>
                  <option value="In progress">In progress</option>
                  <option value="Done">Done</option>
                </select>
              </div>
            </div>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:center;">
            <label style="margin:0; display:flex; align-items:center; gap:8px;">
              <input type="checkbox" id="onlyHot" style="width:auto; transform: scale(1.05);" />
              <span class="small">–¢–æ–ª—å–∫–æ üî¥/üü°</span>
            </label>

            <div class="btns" style="margin-left:auto;">
              <button id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
              <button id="btnImport">–ò–º–ø–æ—Ä—Ç JSON</button>
              <input id="importFile" type="file" accept="application/json" style="display:none" />
              <button id="btnClear" class="danger">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
            </div>
          </div>

          <div class="sep"></div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th style="width:90px;">ID</th>
                  <th>–ó–∞–¥–∞—á–∞</th>
                  <th style="width:190px;">–í–ª–∞–¥–µ–ª–µ—Ü</th>
                  <th style="width:130px;">–°—Ä–æ–∫</th>
                  <th style="width:140px;">–°—Ç–∞—Ç—É—Å</th>
                  <th>–°–ª–µ–¥. —à–∞–≥</th>
                </tr>
              </thead>
              <tbody id="tasksBody"></tbody>
            </table>
          </div>

          <div class="sep"></div>
          <div class="muted small">
            –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ: <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> –≤ —Ñ–æ—Ä–º–µ —Å–ø—Ä–∞–≤–∞.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div class="h">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É (6 –ø–æ–ª–µ–π)</div>
          <div class="muted small">ID –ø—Ä–∏—Å–≤–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
        </div>
        <div class="bd">
          <div>
            <label>–ó–∞–¥–∞—á–∞</label>
            <textarea id="nTask" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É: —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"></textarea>
          </div>
          <div class="row" style="margin-top:10px;">
            <div>
              <label>–í–ª–∞–¥–µ–ª–µ—Ü</label>
              <select id="nOwner"></select>
            </div>
            <div>
              <label>–°—Ä–æ–∫</label>
              <input id="nDue" type="date" />
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <div>
              <label>–°—Ç–∞—Ç—É—Å</label>
              <select id="nStatus">
                <option>Backlog</option>
                <option selected>In progress</option>
                <option>Done</option>
              </select>
            </div>
            <div>
              <label>–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥</label>
              <input id="nNext" placeholder="–û–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: –ø–æ–∑–≤–æ–Ω–∏—Ç—å/–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å/—Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å..." />
            </div>
          </div>

          <div class="btns" style="margin-top:12px;">
            <button class="primary" id="btnAdd">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button id="btnAddDemo">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ–º–æ</button>
          </div>

          <div class="sep"></div>

          <div class="card" style="background: rgba(255,255,255,.02); box-shadow:none;">
            <div class="bd">
              <div class="h" style="font-size:13px; font-weight:700;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
              <div class="muted small" style="margin-top:6px;">
                –ò–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–ø—É—Å–∫–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ <span id="empCount"></span>. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤—Ä—É—á–Ω—É—é ‚Äî –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–∞—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –∑–∞–¥–∞—á.
              </div>
              <div class="row" style="margin-top:10px;">
                <div>
                  <label>–§–ò–û</label>
                  <input id="empName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" />
                </div>
                <div>
                  <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                  <input id="empPos" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≥–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç" />
                </div>
              </div>
              <div class="btns" style="margin-top:10px;">
                <button class="good" id="btnAddEmp">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
              </div>
              <div class="muted small" style="margin-top:10px;">
                –í–∞–∂–Ω–æ: —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –∑–∞–¥–∞—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –î–ª—è –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ ‚Äî –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç JSON.
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- VACATIONS TAB -->
    <section id="tab-vacations" class="grid" style="display:none;">
      <div class="card" style="grid-column: 1 / -1;">
        <div class="hd">
          <div class="h">–ì—Ä–∞—Ñ–∏–∫ –æ—Ç–ø—É—Å–∫–æ–≤ ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</div>
          <div class="btns">
            <select id="yearSel" style="width:auto; min-width: 120px;"></select>
            <button id="btnUpcoming">–ë–ª–∏–∂–∞–π—à–∏–µ 60 –¥–Ω–µ–π</button>
          </div>
        </div>
        <div class="bd">
          <div class="muted small" id="vacInfo"></div>
          <div class="sep"></div>

          <div class="timeline">
            <div class="tl" id="tl"></div>
          </div>

          <div class="sep"></div>
          <div id="upcomingBox" class="muted small"></div>
        </div>
      </div>
    </section>

    <!-- HELP TAB -->
    <section id="tab-help" class="grid" style="display:none;">
      <div class="card" style="grid-column: 1 / -1;">
        <div class="hd"><div class="h">–ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ GitHub Pages</div></div>
        <div class="bd">
          <ol class="small">
            <li>–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä <span class="kbd">drnu-task-tracker</span>.</li>
            <li>–î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª <span class="kbd">index.html</span> –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç—É–¥–∞ —ç—Ç–æ—Ç –∫–æ–¥ —Ü–µ–ª–∏–∫–æ–º.</li>
            <li>–í GitHub: <span class="kbd">Settings ‚Üí Pages</span> ‚Üí Source: <span class="kbd">Deploy from a branch</span> ‚Üí Branch: <span class="kbd">main</span> / folder <span class="kbd">/ (root)</span>.</li>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É Pages ‚Äî —Ç—Ä–µ–∫–µ—Ä –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç.</li>
          </ol>
          <div class="sep"></div>
          <div class="muted small">
            –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ß—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ‚Äú–≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç JSON‚Äù.
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- EDIT MODAL -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="box">
      <div class="hd">
        <div class="h">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ <span id="mId" class="mono"></span></div>
        <div class="btns">
          <button id="mClose">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
      <div class="bd">
        <div>
          <label>–ó–∞–¥–∞—á–∞</label>
          <textarea id="mTask"></textarea>
        </div>
        <div class="row" style="margin-top:10px;">
          <div>
            <label>–í–ª–∞–¥–µ–ª–µ—Ü</label>
            <select id="mOwner"></select>
          </div>
          <div>
            <label>–°—Ä–æ–∫</label>
            <input id="mDue" type="date" />
          </div>
        </div>
        <div class="row" style="margin-top:10px;">
          <div>
            <label>–°—Ç–∞—Ç—É—Å</label>
            <select id="mStatus">
              <option>Backlog</option>
              <option>In progress</option>
              <option>Done</option>
            </select>
          </div>
          <div>
            <label>–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥</label>
            <input id="mNext" />
          </div>
        </div>
        <div class="btns" style="margin-top:12px;">
          <button class="primary" id="mSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="danger" id="mDel">–£–¥–∞–ª–∏—Ç—å</button>
          <button class="good" id="mDone">–û—Ç–º–µ—Ç–∏—Ç—å Done</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–ø—É—Å–∫–æ–≤ (–∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞) ======
    const VACATION_DATA = [
      {
        "name": "–ê–±—É—Å–∞–ª–∏–º–æ–≤ –ê–Ω–∞—Ç–æ–ª–∏–π –õ–∞—á–∏–Ω–æ–≤–∏—á",
        "position": "–ù–∞—á–∞–ª—å–Ω–∏–∫ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞",
        "vacations": [
          { "start": "2026-03-02", "end": "2026-03-06", "days": 5 },
          { "start": "2026-06-15", "end": "2026-06-27", "days": 13 },
          { "start": "2026-08-31", "end": "2026-09-09", "days": 10 }
        ]
      },
      {
        "name": "–ë—É–≥–∞–µ–Ω–∫–æ –ù–∞—Ç–∞–ª—å—è –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-04-20", "end": "2026-04-26", "days": 7 },
          { "start": "2026-07-20", "end": "2026-07-26", "days": 7 },
          { "start": "2026-08-17", "end": "2026-08-30", "days": 14 },
          { "start": "2026-11-16", "end": "2026-11-20", "days": 5 }
        ]
      },
      {
        "name": "–ì–ª–∞–∑–∫–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ì–µ–Ω–Ω–∞–¥—å–µ–≤–Ω–∞",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-06-01", "end": "2026-06-14", "days": 14 },
          { "start": "2026-09-07", "end": "2026-09-20", "days": 14 }
        ]
      },
      {
        "name": "–ö–æ—Ä–Ω–∏—Ö –í–ª–∞–¥–∏—Å–ª–∞–≤ –≠—Ä–Ω–µ—Å—Ç–æ–≤–∏—á",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": []
      },
      {
        "name": "–ö—É–ª–∏—á–∫–∏–Ω –ï–≤–≥–µ–Ω–∏–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-02-16", "end": "2026-03-01", "days": 14 },
          { "start": "2026-08-10", "end": "2026-08-23", "days": 14 }
        ]
      },
      {
        "name": "–û–ª–µ–π–Ω–∏–∫–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è –ï–≤–≥–µ–Ω—å–µ–≤–Ω–∞",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-04-06", "end": "2026-04-19", "days": 14 },
          { "start": "2026-10-05", "end": "2026-10-18", "days": 14 }
        ]
      },
      {
        "name": "–ü–æ–∑–¥–Ω—è–∫–æ–≤–∞ –ò—Ä–∏–Ω–∞ –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-01-19", "end": "2026-02-01", "days": 14 },
          { "start": "2026-07-06", "end": "2026-07-19", "days": 14 }
        ]
      },
      {
        "name": "–°—É—Ä–∂–∏–∫–æ–≤ –°–≤—è—Ç–æ—Å–ª–∞–≤ –ú–∏—Ö–∞–π–ª–æ–≤–∏—á",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-05-18", "end": "2026-05-31", "days": 14 },
          { "start": "2026-12-07", "end": "2026-12-20", "days": 14 }
        ]
      },
      {
        "name": "–§–æ–Ω–∞—Ä–µ–≤ –ê—Ä–∫–∞–¥–∏–π –ê–Ω–¥—Ä–µ–µ–≤–∏—á",
        "position": "–ì–ª–∞–≤–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
        "vacations": [
          { "start": "2026-03-16", "end": "2026-03-29", "days": 14 },
          { "start": "2026-11-02", "end": "2026-11-15", "days": 14 }
        ]
      }
    ];

    // ====== –•—Ä–∞–Ω–∏–ª–∏—â–µ ======
    const LS_TASKS = "drnu_tasks_v1";
    const LS_COUNTER = "drnu_task_counter_v1";
    const LS_EMP = "drnu_employees_v1"; // –¥–æ–ø. —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)

    // ====== –£—Ç–∏–ª–∏—Ç—ã ======
    const $ = (id) => document.getElementById(id);
    const pad2 = (n) => String(n).padStart(2, "0");
    const toISODate = (d) => {
      if (!d) return "";
      const dt = new Date(d);
      if (Number.isNaN(dt.getTime())) return "";
      return `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())}`;
    };
    const fmtRU = (iso) => {
      if (!iso) return "‚Äî";
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return "‚Äî";
      return d.toLocaleDateString("ru-RU");
    };
    const daysBetweenIncl = (aISO, bISO) => {
      const a = new Date(aISO);
      const b = new Date(bISO);
      const ms = (b - a);
      if (Number.isNaN(ms)) return 0;
      return Math.floor(ms / 86400000) + 1; // inclusive
    };
    const todayISO = () => toISODate(new Date());
    const addDaysISO = (iso, n) => {
      const d = new Date(iso);
      d.setDate(d.getDate() + n);
      return toISODate(d);
    };
    const isOverdue = (dueISO) => {
      if (!dueISO) return false;
      return new Date(dueISO) < new Date(todayISO());
    };
    const isDueSoon = (dueISO, days=3) => {
      if (!dueISO) return false;
      const t = new Date(todayISO());
      const d = new Date(dueISO);
      const diff = Math.floor((d - t) / 86400000);
      return diff >= 0 && diff <= days;
    };
    const escapeHTML = (s) => String(s ?? "").replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));

    // ====== –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ======
    function getEmployees() {
      const base = VACATION_DATA.map(e => ({ name: e.name, position: e.position || "" }));
      const extra = JSON.parse(localStorage.getItem(LS_EMP) || "[]");
      const map = new Map();
      for (const e of base) map.set(e.name.trim(), e);
      for (const e of extra) {
        const key = (e.name || "").trim();
        if (!key) continue;
        if (!map.has(key)) map.set(key, { name: key, position: e.position || "" });
      }
      return Array.from(map.values()).sort((a,b)=>a.name.localeCompare(b.name,"ru"));
    }

    // ====== –ó–∞–¥–∞—á–∏ ======
    function loadTasks() { return JSON.parse(localStorage.getItem(LS_TASKS) || "[]"); }
    function saveTasks(tasks) { localStorage.setItem(LS_TASKS, JSON.stringify(tasks)); }
    function nextId() {
      const cur = parseInt(localStorage.getItem(LS_COUNTER) || "0", 10);
      const n = cur + 1;
      localStorage.setItem(LS_COUNTER, String(n));
      return `T-${String(n).padStart(3,"0")}`;
    }

    function renderOwnerSelects() {
      const emps = getEmployees();
      $("empCount").textContent = String(emps.length);

      const ownerOpts = [`<option value="">–í—Å–µ</option>`]
        .concat(emps.map(e => `<option value="${escapeHTML(e.name)}">${escapeHTML(e.name)}</option>`))
        .join("");
      $("fOwner").innerHTML = ownerOpts;

      const ownerOptsNoAll = emps.map(e => `<option value="${escapeHTML(e.name)}">${escapeHTML(e.name)}</option>`).join("");
      $("nOwner").innerHTML = ownerOptsNoAll;
      $("mOwner").innerHTML = ownerOptsNoAll;
    }

    function renderSummary(tasks) {
      const overdue = tasks.filter(t => t.status !== "Done" && isOverdue(t.due)).length;
      const soon = tasks.filter(t => t.status !== "Done" && !isOverdue(t.due) && isDueSoon(t.due, 3)).length;
      const inprog = tasks.filter(t => t.status === "In progress").length;
      const backlog = tasks.filter(t => t.status === "Backlog").length;
      const done = tasks.filter(t => t.status === "Done").length;

      $("summaryChips").innerHTML = [
        `<span class="chip"><span class="dot bad"></span>üî¥ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: <b>${overdue}</b></span>`,
        `<span class="chip"><span class="dot warn"></span>üü° –ì–æ—Ä–∏—Ç (‚â§3 –¥–Ω—è): <b>${soon}</b></span>`,
        `<span class="chip"><span class="dot"></span>üü¢ In progress: <b>${inprog}</b></span>`,
        `<span class="chip"><span class="dot"></span>üì• Backlog: <b>${backlog}</b></span>`,
        `<span class="chip"><span class="dot good"></span>‚úÖ Done: <b>${done}</b></span>`
      ].join("");
    }

    function getFilteredTasks(tasks) {
      const q = ($("q").value || "").trim().toLowerCase();
      const o = $("fOwner").value || "";
      const s = $("fStatus").value || "";
      const hot = $("onlyHot").checked;

      let out = tasks.slice();
      if (q) {
        out = out.filter(t => `${t.id} ${t.task} ${t.owner} ${t.next}`.toLowerCase().includes(q));
      }
      if (o) out = out.filter(t => t.owner === o);
      if (s) out = out.filter(t => t.status === s);
      if (hot) out = out.filter(t => t.status !== "Done" && (isOverdue(t.due) || isDueSoon(t.due, 3)));

      out.sort((a,b) => {
        const ao = (a.status !== "Done" && isOverdue(a.due)) ? 0 : (a.status !== "Done" && isDueSoon(a.due,3) ? 1 : 2);
        const bo = (b.status !== "Done" && isOverdue(b.due)) ? 0 : (b.status !== "Done" && isDueSoon(b.due,3) ? 1 : 2);
        if (ao !== bo) return ao - bo;
        const ad = a.due ? new Date(a.due).getTime() : 1e18;
        const bd = b.due ? new Date(b.due).getTime() : 1e18;
        if (ad !== bd) return ad - bd;
        return a.id.localeCompare(b.id);
      });
      return out;
    }

    function dueBadge(task) {
      if (task.status === "Done") return `<span class="pill good"><span class="dot good"></span>${fmtRU(task.due)}</span>`;
      if (isOverdue(task.due)) return `<span class="pill bad"><span class="dot bad"></span>${fmtRU(task.due)}</span>`;
      if (isDueSoon(task.due, 3)) return `<span class="pill warn"><span class="dot warn"></span>${fmtRU(task.due)}</span>`;
      return `<span class="pill"><span class="dot"></span>${fmtRU(task.due)}</span>`;
    }

    function renderTasks() {
      const tasks = loadTasks();
      renderSummary(tasks);

      const rows = getFilteredTasks(tasks).map(t => `
        <tr data-id="${escapeHTML(t.id)}">
          <td class="mono">${escapeHTML(t.id)}</td>
          <td>${escapeHTML(t.task)}</td>
          <td>${escapeHTML(t.owner || "‚Äî")}</td>
          <td>${dueBadge(t)}</td>
          <td>${escapeHTML(t.status)}</td>
          <td>${escapeHTML(t.next || "")}</td>
        </tr>
      `).join("");

      $("tasksBody").innerHTML = rows || `<tr><td colspan="6" class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ —Å–ø—Ä–∞–≤–∞.</td></tr>`;
      for (const tr of $("tasksBody").querySelectorAll("tr[data-id]")) {
        tr.addEventListener("click", () => openModal(tr.getAttribute("data-id")));
      }
    }

    function addTask() {
      const task = ($("nTask").value || "").trim();
      const owner = $("nOwner").value || "";
      const due = $("nDue").value || "";
      const status = $("nStatus").value || "In progress";
      const next = ($("nNext").value || "").trim();

      if (!task) { alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ ¬´–ó–∞–¥–∞—á–∞¬ª"); return; }

      const tasks = loadTasks();
      tasks.push({ id: nextId(), task, owner, due, status, next });
      saveTasks(tasks);

      $("nTask").value = "";
      $("nNext").value = "";
      renderTasks();
    }

    // ====== –ú–æ–¥–∞–ª–∫–∞ ======
    let editingId = null;
    function openModal(id) {
      const tasks = loadTasks();
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      editingId = id;

      $("mId").textContent = id;
      $("mTask").value = t.task || "";
      $("mOwner").value = t.owner || "";
      $("mDue").value = t.due || "";
      $("mStatus").value = t.status || "In progress";
      $("mNext").value = t.next || "";

      $("modal").classList.add("open");
    }
    function closeModal() { $("modal").classList.remove("open"); editingId = null; }

    function saveModal() {
      if (!editingId) return;
      const tasks = loadTasks();
      const idx = tasks.findIndex(x => x.id === editingId);
      if (idx < 0) return;

      const task = ($("mTask").value || "").trim();
      if (!task) { alert("–ó–∞–¥–∞—á–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π"); return; }

      tasks[idx] = {
        id: editingId,
        task,
        owner: $("mOwner").value || "",
        due: $("mDue").value || "",
        status: $("mStatus").value || "In progress",
        next: ($("mNext").value || "").trim()
      };
      saveTasks(tasks);
      closeModal();
      renderTasks();
    }

    function deleteModal() {
      if (!editingId) return;
      if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É ${editingId}?`)) return;
      saveTasks(loadTasks().filter(x => x.id !== editingId));
      closeModal();
      renderTasks();
    }
    function doneModal() { if (!editingId) return; $("mStatus").value = "Done"; saveModal(); }

    // ====== –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç ======
    function exportJSON() {
      const payload = {
        version: 1,
        exportedAt: new Date().toISOString(),
        tasks: loadTasks(),
        employeesExtra: JSON.parse(localStorage.getItem(LS_EMP) || "[]")
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `drnu-task-tracker-${toISODate(new Date())}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const payload = JSON.parse(reader.result);
          if (Array.isArray(payload.tasks)) saveTasks(payload.tasks);
          if (Array.isArray(payload.employeesExtra)) localStorage.setItem(LS_EMP, JSON.stringify(payload.employeesExtra));
          renderOwnerSelects();
          renderTasks();
          alert("–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω");
        } catch (e) {
          alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON: " + e.message);
        }
      };
      reader.readAsText(file, "utf-8");
    }

    function clearAll() {
      if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å –∑–∞–¥–∞—á–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤?")) return;
      localStorage.removeItem(LS_TASKS);
      localStorage.removeItem(LS_COUNTER);
      localStorage.removeItem(LS_EMP);
      renderOwnerSelects();
      renderTasks();
      renderVacations();
    }

    // ====== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ======
    function addEmployee() {
      const name = ($("empName").value || "").trim();
      const position = ($("empPos").value || "").trim();
      if (!name) { alert("–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"); return; }

      const extra = JSON.parse(localStorage.getItem(LS_EMP) || "[]");
      const exists = extra.some(e => (e.name||"").trim().toLowerCase() === name.toLowerCase())
        || VACATION_DATA.some(e => (e.name||"").trim().toLowerCase() === name.toLowerCase());
      if (exists) { alert("–¢–∞–∫–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ"); return; }

      extra.push({ name, position });
      localStorage.setItem(LS_EMP, JSON.stringify(extra));

      $("empName").value = "";
      $("empPos").value = "";
      renderOwnerSelects();
      renderTasks();
      renderVacations();
    }

    // ====== –û—Ç–ø—É—Å–∫–∞ ======
    function getAllVacationEmployees() {
      const extras = JSON.parse(localStorage.getItem(LS_EMP) || "[]");
      const list = VACATION_DATA.map(e => ({ ...e }));
      for (const ex of extras) {
        const key = (ex.name || "").trim();
        if (!key) continue;
        if (!list.some(x => x.name === key)) {
          list.push({ name: key, position: ex.position || "", vacations: [] });
        }
      }
      list.sort((a,b)=>a.name.localeCompare(b.name,"ru"));
      return list;
    }

    function yearsFromVacations() {
      const years = new Set();
      for (const e of VACATION_DATA) {
        for (const v of (e.vacations || [])) {
          if (v.start) years.add(parseInt(String(v.start).slice(0,4),10));
          if (v.end) years.add(parseInt(String(v.end).slice(0,4),10));
        }
      }
      if (years.size === 0) years.add(new Date().getFullYear());
      return Array.from(years).sort((a,b)=>a-b);
    }

    function renderVacations() {
      const emps = getAllVacationEmployees();
      const years = yearsFromVacations();
      const ySel = $("yearSel");
      const currentY = new Date().getFullYear();
      const prevVal = parseInt(ySel.value || "0", 10) || null;

      ySel.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join("");
      const useYear = (prevVal && years.includes(prevVal)) ? prevVal :
                      (years.includes(currentY) ? currentY : years[0]);
      ySel.value = String(useYear);

      const year = parseInt(ySel.value, 10);
      const yearStart = new Date(`${year}-01-01T00:00:00`);
      const yearEnd = new Date(`${year}-12-31T00:00:00`);
      const yearDays = Math.floor((yearEnd - yearStart) / 86400000) + 1;

      $("vacInfo").textContent = `–ì–æ–¥: ${year}. –ü–æ–ª–æ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—Ç–ø—É—Å–∫–æ–≤ –ø–æ –¥–∞–Ω–Ω—ã–º —Ñ–∞–π–ª–∞.`;

      const monthNames = ["–Ø–Ω–≤","–§–µ–≤","–ú–∞—Ä","–ê–ø—Ä","–ú–∞–π","–ò—é–Ω","–ò—é–ª","–ê–≤–≥","–°–µ–Ω","–û–∫—Ç","–ù–æ—è","–î–µ–∫"];

      let html = `
        <div class="tl-head">
          <div class="left">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
          <div class="months">
            ${monthNames.map(m=>`<div>${m}</div>`).join("")}
          </div>
        </div>
      `;

      emps.forEach((e, idx) => {
        const vacs = (e.vacations || []).filter(v => (v.start || "").startsWith(String(year)) || (v.end || "").startsWith(String(year)));
        const bars = (vacs.length ? vacs : []).map((v, j) => {
          const s = new Date(`${v.start}T00:00:00`);
          const en = new Date(`${v.end}T00:00:00`);
          if (Number.isNaN(s.getTime()) || Number.isNaN(en.getTime())) return "";
          const cs = (s < yearStart) ? yearStart : s;
          const ce = (en > yearEnd) ? yearEnd : en;

          const left = ((cs - yearStart) / 86400000) / yearDays * 100;
          const width = (daysBetweenIncl(toISODate(cs), toISODate(ce)) / yearDays) * 100;
          const label = `${fmtRU(v.start)} ‚Äì ${fmtRU(v.end)}${v.days ? ` ¬∑ ${v.days} –¥–Ω.` : ""}`;
          const cls = (j % 2 === 0) ? "bar" : "bar alt";
          return `<div class="${cls}" style="left:${left}%; width:${Math.max(width, 0.6)}%;" title="${escapeHTML(label)}">${escapeHTML(v.days ? `${v.days} –¥–Ω.` : "–û—Ç–ø—É—Å–∫")}</div>`;
        }).join("");

        html += `
          <div class="tl-row">
            <div class="who">
              <div class="nm">${escapeHTML(e.name)}</div>
              <div class="ps">${escapeHTML(e.position || "")}</div>
            </div>
            <div class="bars">${bars}</div>
          </div>
        `;
      });

      $("tl").innerHTML = html;
      renderUpcoming();
    }

    function renderUpcoming() {
      const now = new Date();
      const from = new Date(now);
      const to = new Date(now);
      to.setDate(to.getDate() + 60);

      const items = [];
      for (const e of getAllVacationEmployees()) {
        for (const v of (e.vacations || [])) {
          if (!v.start || !v.end) continue;
          const s = new Date(`${v.start}T00:00:00`);
          const en = new Date(`${v.end}T00:00:00`);
          if (en < from || s > to) continue;
          items.push({
            name: e.name,
            position: e.position || "",
            start: v.start,
            end: v.end,
            days: v.days || daysBetweenIncl(v.start, v.end)
          });
        }
      }
      items.sort((a,b)=> new Date(a.start) - new Date(b.start));

      if (!items.length) {
        $("upcomingBox").innerHTML = `<div class="muted">–í –±–ª–∏–∂–∞–π—à–∏–µ 60 –¥–Ω–µ–π –æ—Ç–ø—É—Å–∫–æ–≤ –ø–æ –¥–∞–Ω–Ω—ã–º –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`;
        return;
      }
      const rows = items.map(it => `
        <div class="chip">
          <span class="dot"></span>
          <b>${escapeHTML(it.name)}</b>
          <span class="muted">${escapeHTML(it.position)}</span>
          <span>‚Äî</span>
          <span>${escapeHTML(fmtRU(it.start))} ‚Üí ${escapeHTML(fmtRU(it.end))}</span>
          <span class="muted">(${it.days} –¥–Ω.)</span>
        </div>
      `).join("");
      $("upcomingBox").innerHTML = `<div class="h" style="font-size:13px; font-weight:700;">–ë–ª–∏–∂–∞–π—à–∏–µ 60 –¥–Ω–µ–π</div><div style="margin-top:10px;" class="chips">${rows}</div>`;
    }

    // ====== Tabs ======
    function setTab(name) {
      for (const b of document.querySelectorAll(".tab")) {
        b.classList.toggle("active", b.dataset.tab === name);
      }
      $("tab-tasks").style.display = (name === "tasks") ? "grid" : "none";
      $("tab-vacations").style.display = (name === "vacations") ? "grid" : "none";
      $("tab-help").style.display = (name === "help") ? "grid" : "none";
      if (name === "vacations") renderVacations();
      if (name === "tasks") renderTasks();
    }

    // ====== INIT ======
    function init() {
      renderOwnerSelects();
      renderTasks();
      renderVacations();

      $("nDue").value = addDaysISO(todayISO(), 7);

      for (const b of document.querySelectorAll(".tab")) {
        b.addEventListener("click", () => setTab(b.dataset.tab));
      }

      $("btnAdd").addEventListener("click", addTask);
      $("btnAddDemo").addEventListener("click", () => {
        $("nTask").value = "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–æ–ø—Å–æ–≥–ª–∞—à–µ–Ω–∏—è –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é –í–û–õ–° (–≤–µ—Ä—Å–∏—è –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è)";
        $("nNext").value = "–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å —é—Ä–∏—Å—Ç–∞–º–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É";
        $("nStatus").value = "In progress";
      });

      $("nTask").addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") addTask();
      });

      $("q").addEventListener("input", renderTasks);
      $("fOwner").addEventListener("change", renderTasks);
      $("fStatus").addEventListener("change", renderTasks);
      $("onlyHot").addEventListener("change", renderTasks);

      $("btnExport").addEventListener("click", exportJSON);
      $("btnImport").addEventListener("click", () => $("importFile").click());
      $("importFile").addEventListener("change", (e) => {
        const f = e.target.files?.[0];
        if (f) importJSON(f);
        e.target.value = "";
      });
      $("btnClear").addEventListener("click", clearAll);

      $("btnAddEmp").addEventListener("click", addEmployee);

      $("mClose").addEventListener("click", closeModal);
      $("mSave").addEventListener("click", saveModal);
      $("mDel").addEventListener("click", deleteModal);
      $("mDone").addEventListener("click", doneModal);
      $("modal").addEventListener("click", (e) => { if (e.target === $("modal")) closeModal(); });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

      $("yearSel").addEventListener("change", renderVacations);
      $("btnUpcoming").addEventListener("click", () => {
        $("upcomingBox").scrollIntoView({ behavior: "smooth", block: "start" });
      });

      const baseCount = VACATION_DATA.length;
      if (baseCount < 10) {
        $("subtitle").textContent = `–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –í –≥—Ä–∞—Ñ–∏–∫–µ –æ—Ç–ø—É—Å–∫–æ–≤ –Ω–∞–π–¥–µ–Ω–æ ${baseCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –≤—Ä—É—á–Ω—É—é.`;
      }
    }

    init();
  </script>
</body>
</html>
